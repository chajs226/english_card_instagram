<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instagram English Learning Card - Movie Script Template</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Apple SD Gothic Neo', 'Noto Sans KR', sans-serif;
            background: #f8f9fa;
            padding: 20px;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .card {
            width: 400px;
            height: 400px;
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            position: relative;
            overflow: hidden;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: rotate(45deg);
            animation: shimmer 4s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        /* ì¹´ë“œë³„ ë°°ê²½ìƒ‰ */
        .card1 { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card2 { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .card3 { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .card4 { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }

        /* ë°°ê²½ ì´ë¯¸ì§€ê°€ ìˆëŠ” ëª¨ë“  ì¹´ë“œ */
        .card.with-background {
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            position: relative;
        }

        /* ì¹´ë“œ 1: ë¸”ëŸ¬ ì²˜ë¦¬ ì—†ìŒ */
        .card1.with-background::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 20px;
            z-index: 1;
        }

        /* ì¹´ë“œ 2,3,4: ë¸”ëŸ¬ ì²˜ë¦¬ ì ìš© */
        .card2.with-background::after,
        .card3.with-background::after,
        .card4.with-background::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            background: rgba(0, 0, 0, 0.5);
            border-radius: 20px;
            z-index: 1;
        }

        .card.with-background .day-header,
        .card.with-background .card-title,
        .card.with-background .situation-box,
        .card.with-background .dialogue-box,
        .card.with-background .korean-response,
        .card.with-background .thinking-prompt,
        .card.with-background .answer-box {
            position: relative;
            z-index: 10;
        }

        /* ë°°ê²½ ì´ë¯¸ì§€ê°€ ìˆëŠ” ê²½ìš° day-headerëŠ” ì ˆëŒ€ ìœ„ì¹˜ ìœ ì§€ */
        .card.with-background .day-header {
            position: absolute !important;
            top: 20px !important;
            left: 50% !important;
            transform: translateX(-50%) !important;
            z-index: 100 !important;
            white-space: nowrap !important;
        }

        .day-header {
            position: absolute !important;
            top: 20px !important;
            left: 50% !important;
            transform: translateX(-50%) !important;
            color: white;
            font-size: 16px;
            font-weight: bold;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
            z-index: 100;
            width: auto;
            max-width: 360px;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .card-title {
            color: white;
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 25px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
            z-index: 10;
            position: relative;
        }

        .situation-box {
            background: rgba(255,255,255,0.15);
            padding: 20px;
            border-radius: 15px;
            color: white;
            font-size: 16px;
            line-height: 1.6;
            backdrop-filter: blur(10px);
            z-index: 10;
            position: relative;
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
        }

        .dialogue-box {
            background: rgba(255,255,255,0.2);
            padding: 25px;
            border-radius: 15px;
            color: white;
            backdrop-filter: blur(10px);
            z-index: 10;
            position: relative;
            margin-bottom: 15px;
        }

        .english-dialogue {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            font-style: italic;
        }

        .korean-translation {
            font-size: 16px;
            opacity: 0.9;
        }

        .korean-response {
            font-size: 20px;
            font-weight: bold;
            color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
            z-index: 10;
            position: relative;
            margin-bottom: 20px;
        }

        .thinking-prompt {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            color: white;
            font-size: 14px;
            opacity: 0.8;
            backdrop-filter: blur(10px);
            z-index: 10;
            position: relative;
        }

        .answer-box {
            background: rgba(255,255,255,0.2);
            padding: 25px;
            border-radius: 15px;
            color: white;
            backdrop-filter: blur(10px);
            z-index: 10;
            position: relative;
        }

        .answer-label {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #FFE4B5;
        }

        .answer-text {
            font-size: 18px;
            font-weight: bold;
            font-style: italic;
        }

        .controls {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            max-width: 300px;
        }

        .control-group {
            margin-bottom: 15px;
        }

        .control-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            font-size: 14px;
        }

        input, textarea, select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            font-family: inherit;
        }

        textarea {
            resize: vertical;
            min-height: 60px;
        }

        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.3s ease;
            margin: 5px;
        }

        button:hover {
            background: #0056b3;
        }

        .export-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        .export-btn {
            background: #28a745;
            font-size: 12px;
            padding: 8px;
        }

        .export-btn:hover {
            background: #218838;
        }

        .export-all-btn {
            background: #dc3545;
            grid-column: span 2;
        }

        .export-all-btn:hover {
            background: #c82333;
        }

        .caption-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-top: 20px;
            margin-left: 320px; /* ì…ë ¥ ì°½ ë„ˆë¹„(300px) + ì—¬ë°±(20px) */
            margin-right: 20px;
        }

        .caption-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }

        .expression-item {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #007bff;
        }

        .download-status {
            margin-top: 10px;
            padding: 8px;
            border-radius: 5px;
            font-size: 12px;
            text-align: center;
            display: none;
        }

        .download-status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .download-status.processing {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 1024px) {
            .controls {
                position: relative;
                margin-bottom: 20px;
                max-width: 100%;
            }
            
            .caption-section {
                margin-left: 0;
                margin-right: 0;
            }
        }
    </style>
</head>
<body>
    <div class="controls">
        <div class="control-group">
            <label>Day ë²ˆí˜¸:</label>
            <input type="number" id="dayNumber" value="1" min="1">
        </div>
        
        <div class="control-group">
            <label>ë°°ê²½ ì´ë¯¸ì§€ (ì¹´ë“œ 1):</label>
            <input type="file" id="backgroundImage" accept="image/*" onchange="handleImageUpload(event)">
            <button onclick="removeBackground()" style="margin-top: 5px; background: #dc3545; font-size: 12px; padding: 5px 10px;">ë°°ê²½ ì œê±°</button>
        </div>
        
        <div class="control-group">
            <label>ì˜í™” ì œëª©:</label>
            <input type="text" id="movieTitle" value="A Rainy Day in New York" placeholder="ì˜í™” ì œëª©">
        </div>
        
        <div class="control-group">
            <label>ìƒí™© ì„¤ëª…:</label>
            <textarea id="situationText" placeholder="Ashleighì™€ Gatsbyê°€ êµì •ì—ì„œ ë§Œë‚˜ë‹¤."></textarea>
        </div>
        
        <div class="control-group">
            <label>ìƒëŒ€ë°© ì´ë¦„:</label>
            <input type="text" id="opponentName" value="Ashleigh" placeholder="ìƒëŒ€ë°© ì´ë¦„">
        </div>
        
        <div class="control-group">
            <label>ìƒëŒ€ë°© ì˜ì–´ ëŒ€ì‚¬:</label>
            <textarea id="englishDialogue" placeholder="I got an interview with Roland Pollard."></textarea>
        </div>
        
        <div class="control-group">
            <label>í•œê¸€ ë²ˆì—­:</label>
            <textarea id="koreanTranslation" placeholder="Roland Pollardì™€ ì¸í„°ë·°ê°€ ì¡í˜”ì–´"></textarea>
        </div>
        
        <div class="control-group">
            <label>ë‚´ ì´ë¦„:</label>
            <input type="text" id="myName" value="Gatsby" placeholder="ë‚´ ì´ë¦„">
        </div>
        
        <div class="control-group">
            <label>í•œê¸€ ì‘ë‹µ:</label>
            <textarea id="koreanResponse" placeholder="ì™„ì „ ëŒ€ë°•! ì–´ë–»ê²Œ ë§¡ì•˜ì–´?"></textarea>
        </div>
        
        <div class="control-group">
            <label>ì˜ì–´ ì •ë‹µ:</label>
            <textarea id="englishAnswer" placeholder="Oh my gosh, that is amazing. How did you land that?"></textarea>
        </div>
        
        <button onclick="updateCards()">ì¹´ë“œ ì—…ë°ì´íŠ¸</button>
        
        <div class="export-buttons">
            <button class="export-btn" onclick="exportCard(1)">ì¹´ë“œ 1</button>
            <button class="export-btn" onclick="exportCard(2)">ì¹´ë“œ 2</button>
            <button class="export-btn" onclick="exportCard(3)">ì¹´ë“œ 3</button>
            <button class="export-btn" onclick="exportCard(4)">ì¹´ë“œ 4</button>
            <button class="export-btn export-all-btn" onclick="exportAllCards()">ì „ì²´ ë‹¤ìš´ë¡œë“œ</button>
        </div>
        
        <div class="download-status" id="downloadStatus"></div>
    </div>

    <div class="container">
        <!-- Card 1: ìƒí™© ì„¤ëª… -->
        <div class="card card1" id="card1">
            <div class="day-header" id="dayHeader1">A Rainy Day in New York ğŸŒ§</div>
            <div class="card-title">ìƒí™©</div>
            <div class="situation-box" id="situationBox">
                Ashleighì™€ Gatsbyê°€ êµì •ì—ì„œ ë§Œë‚˜ë‹¤.
            </div>
        </div>

        <!-- Card 2: ìƒëŒ€ë°© ì˜ì–´ ëŒ€ì‚¬ + í•œê¸€ ë²ˆì—­ -->
        <div class="card card2" id="card2">
            <div class="day-header" id="dayHeader2">A Rainy Day in New York ğŸŒ§</div>
            <div class="card-title" id="opponentTitle">Ashleigh</div>
            <div class="dialogue-box">
                <div class="english-dialogue" id="englishDialogueText">
                    I got an interview with Roland Pollard.
                </div>
                <div class="korean-translation" id="koreanTranslationText">
                    Roland Pollardì™€ ì¸í„°ë·°ê°€ ì¡í˜”ì–´
                </div>
            </div>
        </div>

        <!-- Card 3: í•œê¸€ ì‘ë‹µ + ìƒê°í•´ë³´ê¸° -->
        <div class="card card3" id="card3">
            <div class="day-header" id="dayHeader3">A Rainy Day in New York ğŸŒ§</div>
            <div class="card-title" id="myTitle">Gatsby</div>
            <div class="korean-response" id="koreanResponseText">
                ì™„ì „ ëŒ€ë°•! ì–´ë–»ê²Œ ë§¡ì•˜ì–´?
            </div>
            <div class="thinking-prompt">
                (ì˜ì–´ë¡œ ì–´ë–»ê²Œ?)
            </div>
        </div>

        <!-- Card 4: ì˜ì–´ ì •ë‹µ -->
        <div class="card card4" id="card4">
            <div class="day-header" id="dayHeader4">A Rainy Day in New York ğŸŒ§</div>
            <div class="card-title">ì •ë‹µ</div>
            <div class="answer-box">
                <div class="answer-label">âœ… ì •ë‹µ:</div>
                <div class="answer-text" id="englishAnswerText">
                    <span id="myNameInAnswer">Gatsby</span>: Oh my gosh, that is amazing. How did you land that?
                </div>
            </div>
        </div>
    </div>

    <!-- í•˜ë‹¨ ìº¡ì…˜ ì½˜í…ì¸  í”„ë¦¬ë·° -->
    <div class="caption-section">
        <div class="caption-title">ğŸ“Œ í•˜ë‹¨ ìº¡ì…˜ìš© ì½˜í…ì¸ </div>
        <div id="captionContent">
            <div class="expression-item">
                <strong>â€¢ "Oh my gosh"</strong> â†’ ë†€ëì„ ë•Œ, "ì„¸ìƒì—!", "í—"
            </div>
            <div class="expression-item">
                <strong>â€¢ "How did you land that?"</strong> â†’ (ê¸°íšŒë¥¼) ì–´ë–»ê²Œ ë”°ëƒˆì–´?<br>
                &nbsp;&nbsp;â—¦ land a job = ì§ì—…ì„ ë”°ë‚´ë‹¤<br>
                &nbsp;&nbsp;â—¦ land an interview = ë©´ì ‘ ê¸°íšŒë¥¼ ì–»ë‹¤
            </div>
            <div style="margin-top: 15px;">
                <strong>ğŸ’¡ ë¹„ìŠ·í•œ ì˜ˆë¬¸:</strong><br>
                â€¢ I can't believe you landed the lead role!<br>
                â€¢ How did you land such an amazing internship?
            </div>
            <div style="margin-top: 15px;">
                <strong>ğŸ¯ ì˜¤ëŠ˜ì˜ ë¯¸ì…˜:</strong><br>
                â†’ "land"ë¥¼ ì¨ì„œ ë„¤ê°€ ë”°ë‚¸ ê¸°íšŒë¥¼ ëŒ“ê¸€ë¡œ ë‚¨ê²¨ë³´ì„¸ìš”!<br>
                (ì˜ˆ: I landed a great project at work.)
            </div>
            <div style="margin-top: 15px; color: #007bff;">
                #DailyEnglish #MovieEnglish #ARainyDayInNewYork #EnglishChallenge
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        // ì´ë¯¸ì§€ ì—…ë¡œë“œ ì²˜ë¦¬ í•¨ìˆ˜
        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            // ì´ë¯¸ì§€ íŒŒì¼ì¸ì§€ í™•ì¸
            if (!file.type.startsWith('image/')) {
                alert('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const imageUrl = e.target.result;
                setCardBackground(imageUrl);
            };
            reader.readAsDataURL(file);
        }

        // ì¹´ë“œì— ë°°ê²½ ì´ë¯¸ì§€ ì„¤ì • (ëª¨ë“  ì¹´ë“œì— ì ìš©)
        function setCardBackground(imageUrl) {
            for(let i = 1; i <= 4; i++) {
                const card = document.getElementById(`card${i}`);
                card.style.backgroundImage = `url(${imageUrl})`;
                card.classList.add('with-background');
            }
            
            showStatus('ë°°ê²½ ì´ë¯¸ì§€ê°€ ëª¨ë“  ì¹´ë“œì— ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
        }

        // ë°°ê²½ ì´ë¯¸ì§€ ì œê±° (ëª¨ë“  ì¹´ë“œì—ì„œ)
        function removeBackground() {
            for(let i = 1; i <= 4; i++) {
                const card = document.getElementById(`card${i}`);
                card.style.backgroundImage = '';
                card.classList.remove('with-background');
            }
            
            // íŒŒì¼ ì…ë ¥ ì´ˆê¸°í™”
            document.getElementById('backgroundImage').value = '';
            
            showStatus('ëª¨ë“  ì¹´ë“œì˜ ë°°ê²½ ì´ë¯¸ì§€ê°€ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        }

        function updateCards() {
            const dayNum = document.getElementById('dayNumber').value;
            const movieTitle = document.getElementById('movieTitle').value;
            const situation = document.getElementById('situationText').value;
            const opponentName = document.getElementById('opponentName').value;
            const englishDialogue = document.getElementById('englishDialogue').value;
            const koreanTranslation = document.getElementById('koreanTranslation').value;
            const myName = document.getElementById('myName').value;
            const koreanResponse = document.getElementById('koreanResponse').value;
            const englishAnswer = document.getElementById('englishAnswer').value;

            // í—¤ë”ë¥¼ 'Day X of ì˜í™”ì œëª©' í˜•ì‹ìœ¼ë¡œ ì—…ë°ì´íŠ¸
            const movieHeader = `Day${dayNum} of ${movieTitle} ğŸ¬`;
            for(let i = 1; i <= 4; i++) {
                document.getElementById(`dayHeader${i}`).textContent = movieHeader;
            }

            // ê° ì¹´ë“œ ë‚´ìš© ì—…ë°ì´íŠ¸
            if(situation) {
                document.getElementById('situationBox').textContent = situation;
            }

            if(opponentName) {
                document.getElementById('opponentTitle').textContent = opponentName;
            }

            if(englishDialogue) {
                document.getElementById('englishDialogueText').textContent = englishDialogue;
            }

            if(koreanTranslation) {
                document.getElementById('koreanTranslationText').textContent = koreanTranslation;
            }

            if(myName) {
                document.getElementById('myTitle').textContent = myName;
                document.getElementById('myNameInAnswer').textContent = myName;
            }

            if(koreanResponse) {
                document.getElementById('koreanResponseText').textContent = koreanResponse;
            }

            if(englishAnswer) {
                const answerWithName = englishAnswer.includes(':') ? englishAnswer : `${myName}: ${englishAnswer}`;
                document.getElementById('englishAnswerText').innerHTML = answerWithName;
            }
        }

        // ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜
        function showStatus(message, type = 'processing') {
            const status = document.getElementById('downloadStatus');
            status.textContent = message;
            status.className = `download-status ${type}`;
            status.style.display = 'block';
            
            if (type === 'success') {
                setTimeout(() => {
                    status.style.display = 'none';
                }, 3000);
            }
        }

        // ê°œë³„ ì¹´ë“œ export í•¨ìˆ˜
        async function exportCard(cardNumber) {
            const card = document.getElementById(`card${cardNumber}`);
            const movieTitle = document.getElementById('movieTitle').value || 'Movie';
            const dayNum = document.getElementById('dayNumber').value;

            showStatus(`ì¹´ë“œ ${cardNumber} ìƒì„± ì¤‘...`, 'processing');

            try {
                // ì›ë³¸ ì¹´ë“œì˜ í˜„ì¬ ìŠ¤íƒ€ì¼ ì •ë³´ ìˆ˜ì§‘
                const cardRect = card.getBoundingClientRect();
                const cardStyles = window.getComputedStyle(card);
                const hasBackground = card.classList.contains('with-background');
                const backgroundImage = card.style.backgroundImage;
                
                // í˜ì´ì§€ ë Œë”ë§ ì™„ë£Œ ëŒ€ê¸°
                await new Promise(resolve => setTimeout(resolve, 1000));

                // ë§¤ìš° ë‹¨ìˆœí•˜ê³  ì§ì ‘ì ì¸ ì˜µì…˜ìœ¼ë¡œ ì„¤ì •
                const options = {
                    width: 400,
                    height: 400,
                    scale: 2,
                    backgroundColor: null,
                    useCORS: true,
                    allowTaint: true,
                    logging: true,
                    removeContainer: false,
                    foreignObjectRendering: false,
                    imageTimeout: 30000,
                    onclone: function(clonedDoc, element) {
                        console.log('Starting clone process for card', cardNumber);
                        
                        // í´ë¡ ëœ ì¹´ë“œ ì°¾ê¸°
                        const clonedCard = clonedDoc.getElementById(`card${cardNumber}`);
                        if (!clonedCard) {
                            console.error('Cloned card not found');
                            return;
                        }

                        // ì›ë³¸ ì¹´ë“œì—ì„œ ë°°ê²½ ì´ë¯¸ì§€ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                        const originalCard = document.getElementById(`card${cardNumber}`);
                        const originalBgImage = originalCard.style.backgroundImage;
                        
                        console.log('Original background image:', originalBgImage);
                        console.log('Has background class:', hasBackground);

                        // ê¸°ë³¸ ì¹´ë“œ ìŠ¤íƒ€ì¼ ê°•ì œ ì ìš©
                        clonedCard.style.cssText = `
                            width: 400px !important;
                            height: 400px !important;
                            border-radius: 20px !important;
                            display: flex !important;
                            flex-direction: column !important;
                            justify-content: center !important;
                            align-items: center !important;
                            text-align: center !important;
                            padding: 30px !important;
                            position: relative !important;
                            overflow: hidden !important;
                            box-shadow: 0 10px 30px rgba(0,0,0,0.15) !important;
                        `;

                        // ë°°ê²½ ì„¤ì •
                        if (hasBackground && originalBgImage && originalBgImage !== 'none') {
                            // ë°°ê²½ ì´ë¯¸ì§€ê°€ ìˆëŠ” ê²½ìš°
                            const gradients = [
                                'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                                'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
                                'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
                                'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)'
                            ];
                            
                            clonedCard.style.background = `${originalBgImage}, ${gradients[cardNumber - 1]}`;
                            clonedCard.style.backgroundSize = 'cover';
                            clonedCard.style.backgroundPosition = 'center';
                            clonedCard.style.backgroundRepeat = 'no-repeat';
                            
                            console.log('Applied background:', clonedCard.style.background);
                        } else {
                            // ê¸°ë³¸ ê·¸ë¼ë°ì´ì…˜ë§Œ
                            const gradients = [
                                'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                                'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
                                'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
                                'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)'
                            ];
                            clonedCard.style.background = gradients[cardNumber - 1];
                        }

                        // ë°°ê²½ ì˜¤ë²„ë ˆì´ ì¶”ê°€ (ë°°ê²½ ì´ë¯¸ì§€ê°€ ìˆëŠ” ê²½ìš°)
                        if (hasBackground) {
                            const overlay = clonedDoc.createElement('div');
                            overlay.style.cssText = `
                                position: absolute !important;
                                top: 0 !important;
                                left: 0 !important;
                                right: 0 !important;
                                bottom: 0 !important;
                                background: ${cardNumber === 1 ? 'rgba(0, 0, 0, 0.4)' : 'rgba(0, 0, 0, 0.6)'} !important;
                                border-radius: 20px !important;
                                z-index: 1 !important;
                                pointer-events: none !important;
                            `;
                            clonedCard.appendChild(overlay);
                        }

                        // day-header ìŠ¤íƒ€ì¼ ê°•ì œ ì ìš©
                        const dayHeader = clonedCard.querySelector('.day-header');
                        if (dayHeader) {
                            dayHeader.style.cssText = `
                                position: absolute !important;
                                top: 20px !important;
                                left: 20px !important;
                                right: 20px !important;
                                transform: none !important;
                                color: white !important;
                                font-size: 16px !important;
                                font-weight: bold !important;
                                text-shadow: 0 2px 8px rgba(0,0,0,0.8) !important;
                                z-index: 100 !important;
                                text-align: center !important;
                                white-space: nowrap !important;
                                overflow: visible !important;
                                text-overflow: clip !important;
                                width: auto !important;
                                max-width: none !important;
                                margin: 0 !important;
                                padding: 0 !important;
                            `;
                            console.log('Day header text:', dayHeader.textContent);
                        }

                        // ë‹¤ë¥¸ ëª¨ë“  í…ìŠ¤íŠ¸ ìš”ì†Œë“¤ z-index ì¡°ì •
                        const textElements = clonedCard.querySelectorAll('.card-title, .situation-box, .dialogue-box, .korean-response, .thinking-prompt, .answer-box');
                        textElements.forEach(el => {
                            el.style.position = 'relative';
                            el.style.zIndex = '10';
                            el.style.textShadow = '0 2px 8px rgba(0,0,0,0.8)';
                        });

                        // situation-box ìŠ¤íƒ€ì¼
                        const situationBox = clonedCard.querySelector('.situation-box');
                        if (situationBox) {
                            situationBox.style.background = 'rgba(255,255,255,0.25)';
                            situationBox.style.borderRadius = '15px';
                            situationBox.style.padding = '20px';
                        }

                        // dialogue-box ìŠ¤íƒ€ì¼
                        const dialogueBox = clonedCard.querySelector('.dialogue-box');
                        if (dialogueBox) {
                            dialogueBox.style.background = 'rgba(255,255,255,0.3)';
                            dialogueBox.style.borderRadius = '15px';
                            dialogueBox.style.padding = '25px';
                            dialogueBox.style.marginBottom = '15px';
                        }

                        // thinking-prompt ìŠ¤íƒ€ì¼
                        const thinkingPrompt = clonedCard.querySelector('.thinking-prompt');
                        if (thinkingPrompt) {
                            thinkingPrompt.style.background = 'rgba(255,255,255,0.2)';
                            thinkingPrompt.style.borderRadius = '10px';
                            thinkingPrompt.style.padding = '15px';
                        }

                        // answer-box ìŠ¤íƒ€ì¼
                        const answerBox = clonedCard.querySelector('.answer-box');
                        if (answerBox) {
                            answerBox.style.background = 'rgba(255,255,255,0.3)';
                            answerBox.style.borderRadius = '15px';
                            answerBox.style.padding = '25px';
                        }

                        console.log('Clone styling completed');
                    }
                };

                console.log('Starting html2canvas with card:', cardNumber);
                const canvas = await html2canvas(card, options);
                console.log('html2canvas completed, canvas size:', canvas.width, 'x', canvas.height);

                if (!canvas || canvas.width === 0 || canvas.height === 0) {
                    throw new Error('Canvas generation failed - empty canvas');
                }

                canvas.toBlob(function(blob) {
                    if (!blob) {
                        showStatus('ì´ë¯¸ì§€ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                        return;
                    }
                    
                    console.log('Blob created, size:', blob.size);
                    
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `${movieTitle}_Day${dayNum}_Card${cardNumber}.png`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(url);
                    
                    showStatus(`ì¹´ë“œ ${cardNumber} ë‹¤ìš´ë¡œë“œ ì™„ë£Œ!`, 'success');
                }, 'image/png', 1.0);

            } catch (error) {
                console.error('Export failed:', error);
                showStatus(`ë‹¤ìš´ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`, 'error');
            }
        }

        // ì „ì²´ ì¹´ë“œ export í•¨ìˆ˜
        async function exportAllCards() {
            showStatus('ì „ì²´ ì¹´ë“œ ìƒì„± ì¤‘...', 'processing');
            
            for (let i = 1; i <= 4; i++) {
                await new Promise(resolve => {
                    setTimeout(async () => {
                        await exportCard(i);
                        resolve();
                    }, i * 1000);
                });
            }
            
            showStatus('ì „ì²´ ì¹´ë“œ ë‹¤ìš´ë¡œë“œ ì™„ë£Œ!', 'success');
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ë°ì´í„° ì„¤ì •
        window.addEventListener('load', function() {
            // ê¸°ë³¸ ë°ì´í„° ì„¤ì •
            document.getElementById('situationText').value = 'Ashleighì™€ Gatsbyê°€ êµì •ì—ì„œ ë§Œë‚˜ë‹¤.';
            document.getElementById('englishDialogue').value = 'I got an interview with Roland Pollard.';
            document.getElementById('koreanTranslation').value = 'Roland Pollardì™€ ì¸í„°ë·°ê°€ ì¡í˜”ì–´';
            document.getElementById('koreanResponse').value = 'ì™„ì „ ëŒ€ë°•! ì–´ë–»ê²Œ ë§¡ì•˜ì–´?';
            document.getElementById('englishAnswer').value = 'Oh my gosh, that is amazing. How did you land that?';
            
            // ì´ˆê¸° ì¹´ë“œ ì—…ë°ì´íŠ¸
            updateCards();
        });
    </script>
</body>
</html>